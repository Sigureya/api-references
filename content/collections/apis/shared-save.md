---
title: 共有セーブを利用する
slug: shared-save
description: RPGアツマール内で動作する特定のサーバーセーブデータを取得するAPIです
order: 26
experimental: true
---

## 概要

指定ユーザーの特定キー（`Atsumaru Shared`）のサーバーセーブデータを取得できる機能です。  
このセーブデータのことを「共有セーブ」と呼びます。


### なにができるのか

指定ユーザーの共有セーブを取得できます。この機能だけでは誰からデータを取得すればいいのかわかりませんが、他APIと組み合わせることにより、非同期通信型のゲームが制作可能になります。  
例えば、[ユーザー情報API](/user)で、そのゲームを最近プレイしたユーザーがわかるので、そのユーザーの共有セーブに保存されたデータ（例えばアイテムなど）を取得することで、疑似的なすれ違い通信のようなゲームが作成できます。

#### 利用想定／利用例
この機能は、以下のような使い方を想定しています。
- 選択したアバターと一言メッセージを保存し、表示する広場
- 作成したモンスターキャラクターのデータ共有

例えば、次のサンプルゲームではこの機能を利用し、選択したアバターと一言メッセージを共有セーブに保存しています。
- [【ゲームAPIサンプル】AsyncProfile（ユーザー情報取得API・共有セーブAPI）](https://game.nicovideo.jp/atsumaru/games/gm9291)

また、こちらのサンプルゲームでは、作成したスライムの情報を共有セーブに保存し、ほかのユーザーの作成したスライムと戦わせています。（バトルの結果は、[ユーザーシグナル](/signal)で送信しています）
- [【ゲームAPIサンプル】スライムバトラー（ユーザーシグナルAPI・共有セーブAPI）](https://game.nicovideo.jp/atsumaru/games/gm9294)


## 機能詳細

- 共有対象のデータは、`Atsumaru Shared` というkeyで保存されたサーバーセーブデータです。
 - keyについては[こちら](/storage)を参照ください。
 - 共有対象にしたくないデータは、このkeyを使わないようにご注意ください。
- 本機能でできるのは共有セーブの **取得のみ** で、共有元への書き込みはできません。
- 一度に取得できるデータは100件までで、それ以上のデータを一度に取得しようとするとエラーになります。

### 共有セーブの取得条件

- 取得できるのは同一ゲームあるいは同一作者のゲーム且つ、[プレイヤー間通信の有効化](/common/interplayer)しているユーザー間のみです。
- 存在しないユーザーや、共有セーブが無いユーザー、プレイヤー間通信が有効化されていないユーザーのデータを取得しようとした場合、そのユーザーの分だけデータが取得できません。
- ゲーム作者の場合は、ゲームの公開状態によらず、共有セーブを取得できます。
- 作者以外は公開状態のゲームでのみ共有セーブを取得できます。限定公開・非公開状態のゲームの共有セーブを取得できません。
- 自分自身の共有セーブはプレイヤー間通信の有効化をしていなくてもセーブを取得できます。
- 未ログインユーザーは共有セーブをサーバーに保存できないため、取得のみとなります。

## 利用方法

共有セーブ機能は次の方法で利用できます。

方法 | 場所
:---|:---
ゲームAPI | 以下の「APIでの利用方法」を参考に、直接APIを呼び出してください


### APIでの利用方法

#### 共有セーブの取得

メソッド | `window.RPGAtsumaru.experimental.storage.getSharedItems(userIds: number[], gameId: number &#124; null)`
:---|:---
説明 | 指定したユーザの `Atsumaru Shared` というキーで保存したセーブデータを取得する。
引数 | <ul><li>`userIds[]` : ユーザー情報を取得したいユーザーのニコニコユーザーIDの配列を自然数で、最大100件まで指定します。</li><li>`gameId` : 現在プレイ中のゲーム以外からセーブデータを取得する場合、ゲームのIDを自然数で指定します。</li></ul>
戻り値 | `Promise<{ [userId: number]: string }>`
リリース日 | 2018/12/17
更新日 | 2018/12/17

- `userIds` で指定したユーザーのセーブデータユーザーのデータを取得できます。
  - 指定したユーザーのうち、取得先のゲームで [プレイヤー間通信の有効化](/common/interplayer) をしているユーザーのセーブデータのみ取得できます。
  - 自分自身のデータは対象ゲームで有効化していなくてもセーブを取得できます
- 第二引数の `gameId` を指定することで、別のゲームの共有セーブを取得できます。
  - セーブを取得しようとするゲームと、同じ作者のゲームのidを指定された場合のみ、取得可能です。
  - 作者以外は取得しようとするゲームが公開状態の場合のみ、共有セーブを取得できます。
  - 作者は非公開状態のゲームの共有セーブも取得できます。

##### 戻り値の例

```js
// window.RPGAtsumaru.experimental.storage.getSharedItems([123, 456, 789]) を実行
{
  123: "ユーザー1234の共有データ",
  456: "ユーザー5678の共有データ"
  // 789 のユーザーが取得先のゲームで「プレイヤー間通信の有効化」されていない場合は結果に含まれません！
}
```
