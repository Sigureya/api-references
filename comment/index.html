<!DOCTYPE html><html lang="en-US"><head><title data-react-helmet="true">コメントを利用する - RPGアツマール APIリファレンス</title><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/><meta data-react-helmet="true" name="description" content="RPGアツマールに投稿したゲームから利用可能なAPIのリファレンスです。"/><meta data-react-helmet="true" name="keywords" content="RPGアツマール,RPGツクールMV,自作ゲーム,インディーズゲーム,ゲーム,フリーゲーム,同人ゲーム,無料,niconico"/><meta data-react-helmet="true" property="og:title" content="コメントを利用する - RPGアツマール APIリファレンス"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:url" content="https://site.nicovideo.jp/atsumaru/declaration/"/><meta data-react-helmet="true" property="og:image" content="https://site.nicovideo.jp/atsumaru/declaration/img/2018/img2.jpg"/><meta data-react-helmet="true" property="og:site_name" content="RPGアツマール"/><meta data-react-helmet="true" property="og:description" content="RPGアツマールに投稿したゲームから利用可能なAPIのリファレンスです。"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:site" content="@nico_indiesgame"/><link rel="preload" as="script" href="https://atsumaru.github.io/api-references/bootstrap.1f779964.js"/><link rel="preload" as="script" href="https://atsumaru.github.io/api-references/templates/src/containers/Reference.139ff39d.js"/><link rel="preload" as="script" href="https://atsumaru.github.io/api-references/main.103f01e7.js"/><link rel="preload" as="style" href="https://atsumaru.github.io/api-references/styles.0f364fc3.css"/><link rel="stylesheet" href="https://atsumaru.github.io/api-references/styles.0f364fc3.css"/><link data-react-helmet="true" rel="icon" href="https://atsumaru.github.io/api-references/static/favicon.cdb3578c.ico"/><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no"/></head><body><div id="root"><div class="MainLayout" data-reactroot=""><header class="Header"><nav class="Header__Nav"><a href="http://www.nicovideo.jp/">niconico</a><a href="https://game.nicovideo.jp/atsumaru/">RPGアツマール</a></nav></header><main class="MainLayout__Body"><nav class="MainNavigation"><div class="MainNavigation__LogoContainer"><a class="MainNavigation__Logo active" aria-current="page" href="https://atsumaru.github.io/api-references/"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfoAAABACAYAAADyM7XuAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAN1wAADdcBQiibeAAAAAd0SU1FB+ELBwkPCQpe9MsAAAVPSURBVHja7d0/bxtlHAfwOycSEahDByqmorMzFejGUghKp5aKMZkRK0HNS0DlHaQi7B1ROiIoUysq9QVQ0QHiWJUYUCqBSoUEUnMPS1vFTuLz2Xfx/fl8pAxu7lzfPXa+fn7PPc/FUflCzu3jCAAoRMcpAABBDwAIegCgSnKPh98/0+sffrzyrN8b2SRk7D/0+P1vXx/7/y1de1j6MQFAUy1OsU/XaQOAelC6BwBBDwDU0WIBz5FrTD5L3cbk75/pZa4T8OmbobJvgL29vWPPX7fbreyL3tt8K3ujzQfHHtfC9TuZx/X2d59rr4q0V97jOnx+Ztn3JEU9Z5Xb6/En32Ruc3DzaquuhZpXu0/yntSjB4CWE/QAIOgBgDo6box+dAxh7BhB3jH4LP9+/17eXf4c87vfl649vKiZARD09XV2zO+eaWIA2kzpHgAEPQBQR5OU7nPN+/vw791SX/B/P4wfch+Zh38+ynnNAQC0LegZo8qL4TRVd+uPzG32Tvj3Ki+Go72ogkk+I9qrXpTuAUDQAwB1tHjM/eVzPUHZY/KjXvv456HHo2P2o/Pwp1g7v1RFrV18knmtoe24mv2+qkt71YX24lSDPnJ/eQBoLKV7ABD0AEAdHZleN7p2fd4x+xowrx4APXoAoIE9esrV1Ktb23bVrlkAUP2/A7ee5Pu4rDzrN/LzpUcPAI3u0XcWhgfl04OhQfm895uP4+EvRCHM9gVv1uer+rx6ACg16Fee/ro3S7ADkE+3292Jomht0u1DCOuDweB20a9jeXl59eDg4Est0mynXrqP43jsD0DTxXG8EUXRfo7tt3u93rkiAz5Jkrtpmt6N43hViwh6AArU7/f3QwgbOXY5F0LYFvBMYzEamVe++lm+99LzOR/A0m9ncn+Z1uxwvKpdNT3LLIOqz1AYDAa3u93u7WjyEv5akiRr05TwX5bo0zRdVTnVowfglJRdwteDZy5BH0IY+wPQFmWV8AU8evQAFfGiFJ+nHL+WJMnaPAI+hHCv0+lc1mr1cmRlvIObV4ceL1y/k7vHXnQFIJfNB8OPty6NPg4j2xuwAuYqjuONEMJHURSdm3D77V6v91O/399/GfBljsGHEO4tLCzc2N3dvae19OgByGnaEv5p9eAHg8FlId+gHj3lOulK4LxXO1ftiuK2rcFe1PG27R4BnGyaq/DTNF2rUg++an8HVlr8flpeXr6Qpul6FEXrgh6gIvKW8KsS8FQv3NM0fedwj370G1izehhZY/YAFdHv9/eTJNmI43hHwDNLuB+mRw9QIVOU8AW8cB9L0ANUTNklfAHf/HAX9AAVVlYJX8C3J9xzBX3WvPrFzR+HHj/fulLuN92bH8z2BA2ZN1/U1dptu1p+Xue5qa+z7PdPm2clFFnCF/D1lKbpL0U8jx49QEXNWsIX8ESRBXMAKmuKhXReBbyFbtCjb4FHX7+Ruc3SNeepKm49ya6CrzhNrft8TVnC3xbw9XzPXPjin1MJ+qG/NgvX7zyOouj8xE84Mmaf5aD3VdHH1Ox1AYDWmXUtfNpN6R6g4sq6nS2CHoCKKPJ2trTCoyiKbnQ6nXczx+hDHD+NQ/hrzCZnnU+A8inhM0G473Q6nZ3d3d1XU/Mygz7dunIx67tAnleR9/72R9aqH5W9dr154kAjTLGQzssS/rqz165wP8xV9wA1Ms3tbJMkWXtR+qcl4S7oAWpMCV+459lR0APUjBK+cM/1xXCKfQodkz8yjz5rTH70NW9dCiP7G5MHgBdMrwMAQQ8ACHoAoFLmMZ4davAaAUCPHgAQ9ACAoAcAivY/6RWnrHV1g5UAAAAASUVORK5CYII=" alt="RPGアツマール"/>APIリファレンス</a></div><a class="MainNavigationItem" href="https://atsumaru.github.io/api-references/">概要</a><div><a class="MainNavigationItem active" aria-current="page" title="RPGアツマールのコメント機能を利用するにはCommentAPIを利用してください。" href="https://atsumaru.github.io/api-references/comment"><span class="MainNavigationItem__Text">コメントを利用する</span></a><div class="MainNavigationItem__Children" aria-hidden="false"></div></div><div><a class="MainNavigationItem" title="スマートフォンでのゲームプレイ時に、バーチャルコントローラーからの入力を受け取るためのAPIです。" href="https://atsumaru.github.io/api-references/controller"><span class="MainNavigationItem__Text">コントローラーを利用する</span></a><div class="MainNavigationItem__Children" aria-hidden="true"></div></div><div><a class="MainNavigationItem" title="サーバーセーブ機能を利用するにはStorageAPIを利用してください。サーバーセーブ機能は現在APIのみで利用が可能で、プラグインを通じた機能利用はできません。" href="https://atsumaru.github.io/api-references/storage"><span class="MainNavigationItem__Text">サーバーにセーブを保存する</span></a><div class="MainNavigationItem__Children" aria-hidden="true"></div></div><div><a class="MainNavigationItem" title="マスターボリュームの調整を行うにはVolumeAPIを利用してください。マスターボリューム設定は現在APIのみで利用が可能で、プラグインを通じた機能利用はできません。" href="https://atsumaru.github.io/api-references/volume"><span class="MainNavigationItem__Text">マスターボリュームの設定</span></a><div class="MainNavigationItem__Children" aria-hidden="true"></div></div><div><a class="MainNavigationItem" title="RPGアツマールで外部リンクを設置したい場合は、専用のダイアログを開いてダイアログ内で外部リンクを表示します。" href="https://atsumaru.github.io/api-references/popup"><span class="MainNavigationItem__Text">外部リンクを表示する</span></a><div class="MainNavigationItem__Children" aria-hidden="true"></div></div><div><a class="MainNavigationItem" title="RPGアツマールでURLのquery情報を取得するにはこの機能を利用します。" href="https://atsumaru.github.io/api-references/copy-query"><svg viewBox="0 0 24 24" class="MainNavigationItem__Icon"><path d="M9 2C8 2 8 3 8 3s0 1 1 1v7.367188l-3.9335938 6.884765c-1.0407086 1.821241-1.11276 3.000196-.7734374 3.763672.3393224.763476 1.0859374.96875 1.0859374.96875.0395749.010135.0802425.015383.1210938.015625h13c.04085-.000242.08152-.005495.121094-.015625 0 0 .746615-.205274 1.085937-.96875.339323-.763476.267272-1.942431-.773437-3.763672L15 11.367188V4s1 0 1-1-1-1-1-1h-1v9.5c.000167.08705.023056.172554.066406.248047l4 7c.959291 1.678759.88724 2.499804.726563 2.861328-.154565.347753-.380331.387021-.398438.390625H5.6054688c-.0181066-.003604-.2438806-.042872-.3984376-.390625-.1606773-.361524-.2327286-1.182569.7265626-2.861328l4-7c.043349-.075492.0662393-.160994.0664062-.248047V2H9zm1 12.5a1 1 0 0 0-1 1c-.1818651-.000015-.3493995.098711-.4375.257812l-2.5 4.5c-.18445.333279.0565842.742177.4375.742188h11c.380916-.000011.62195-.408909.4375-.742188l-2.5-4.5c-.0881-.1591-.255635-.257827-.4375-.257812h-.634766A1 1 0 0 0 13.5 15a1 1 0 0 0-.863281.5H11a1 1 0 0 0-1-1zm4 1.5a.5.5 0 0 1 .5.5.5.5 0 0 1-.5.5.5.5 0 0 1-.5-.5.5.5 0 0 1 .5-.5zm-3.5.5a.5.5 0 0 1 .5.5.5.5 0 0 1-.5.5.5.5 0 0 1-.5-.5.5.5 0 0 1 .5-.5zM13 18a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1z"></path></svg><span class="MainNavigationItem__Text">クエリ情報の取得</span></a><div class="MainNavigationItem__Children" aria-hidden="true"></div></div><div><a class="MainNavigationItem" title="RPGアツマールのゲームの作者情報が記載されたダイアログを表示することができます。" href="https://atsumaru.github.io/api-references/creator-modal"><svg viewBox="0 0 24 24" class="MainNavigationItem__Icon"><path d="M9 2C8 2 8 3 8 3s0 1 1 1v7.367188l-3.9335938 6.884765c-1.0407086 1.821241-1.11276 3.000196-.7734374 3.763672.3393224.763476 1.0859374.96875 1.0859374.96875.0395749.010135.0802425.015383.1210938.015625h13c.04085-.000242.08152-.005495.121094-.015625 0 0 .746615-.205274 1.085937-.96875.339323-.763476.267272-1.942431-.773437-3.763672L15 11.367188V4s1 0 1-1-1-1-1-1h-1v9.5c.000167.08705.023056.172554.066406.248047l4 7c.959291 1.678759.88724 2.499804.726563 2.861328-.154565.347753-.380331.387021-.398438.390625H5.6054688c-.0181066-.003604-.2438806-.042872-.3984376-.390625-.1606773-.361524-.2327286-1.182569.7265626-2.861328l4-7c.043349-.075492.0662393-.160994.0664062-.248047V2H9zm1 12.5a1 1 0 0 0-1 1c-.1818651-.000015-.3493995.098711-.4375.257812l-2.5 4.5c-.18445.333279.0565842.742177.4375.742188h11c.380916-.000011.62195-.408909.4375-.742188l-2.5-4.5c-.0881-.1591-.255635-.257827-.4375-.257812h-.634766A1 1 0 0 0 13.5 15a1 1 0 0 0-.863281.5H11a1 1 0 0 0-1-1zm4 1.5a.5.5 0 0 1 .5.5.5.5 0 0 1-.5.5.5.5 0 0 1-.5-.5.5.5 0 0 1 .5-.5zm-3.5.5a.5.5 0 0 1 .5.5.5.5 0 0 1-.5.5.5.5 0 0 1-.5-.5.5.5 0 0 1 .5-.5zM13 18a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1z"></path></svg><span class="MainNavigationItem__Text">作者情報を表示する</span></a><div class="MainNavigationItem__Children" aria-hidden="true"></div></div><div><a class="MainNavigationItem" title="RPGアツマール内で動作するゲームのスコア(点数)を記録・取得できる仕組みです。" href="https://atsumaru.github.io/api-references/scoreboard"><svg viewBox="0 0 24 24" class="MainNavigationItem__Icon"><path d="M9 2C8 2 8 3 8 3s0 1 1 1v7.367188l-3.9335938 6.884765c-1.0407086 1.821241-1.11276 3.000196-.7734374 3.763672.3393224.763476 1.0859374.96875 1.0859374.96875.0395749.010135.0802425.015383.1210938.015625h13c.04085-.000242.08152-.005495.121094-.015625 0 0 .746615-.205274 1.085937-.96875.339323-.763476.267272-1.942431-.773437-3.763672L15 11.367188V4s1 0 1-1-1-1-1-1h-1v9.5c.000167.08705.023056.172554.066406.248047l4 7c.959291 1.678759.88724 2.499804.726563 2.861328-.154565.347753-.380331.387021-.398438.390625H5.6054688c-.0181066-.003604-.2438806-.042872-.3984376-.390625-.1606773-.361524-.2327286-1.182569.7265626-2.861328l4-7c.043349-.075492.0662393-.160994.0664062-.248047V2H9zm1 12.5a1 1 0 0 0-1 1c-.1818651-.000015-.3493995.098711-.4375.257812l-2.5 4.5c-.18445.333279.0565842.742177.4375.742188h11c.380916-.000011.62195-.408909.4375-.742188l-2.5-4.5c-.0881-.1591-.255635-.257827-.4375-.257812h-.634766A1 1 0 0 0 13.5 15a1 1 0 0 0-.863281.5H11a1 1 0 0 0-1-1zm4 1.5a.5.5 0 0 1 .5.5.5.5 0 0 1-.5.5.5.5 0 0 1-.5-.5.5.5 0 0 1 .5-.5zm-3.5.5a.5.5 0 0 1 .5.5.5.5 0 0 1-.5.5.5.5 0 0 1-.5-.5.5.5 0 0 1 .5-.5zM13 18a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1z"></path></svg><span class="MainNavigationItem__Text">スコアボードを利用する</span><button class="MainNavigationItem__Button" data-is-open="false"></button></a><div class="MainNavigationItem__Children" aria-hidden="true"><a class="MainNavigationItem MainNavigationItem--child" title="スコアボードの設定画面の使用方法を解説します。" href="https://atsumaru.github.io/api-references/scoreboard/setting"><span class="MainNavigationItem__Text">スコアボード設定画面を利用する</span></a><a class="MainNavigationItem MainNavigationItem--child" title="公式プラグインを利用した、スコアボードの利用方法について解説します。" href="https://atsumaru.github.io/api-references/scoreboard/plugin"><span class="MainNavigationItem__Text">スコアボードプラグインを利用する</span></a><a class="MainNavigationItem MainNavigationItem--child" title="アツマールAPIを使ったスコアボードの利用方法について解説します。" href="https://atsumaru.github.io/api-references/scoreboard/api"><span class="MainNavigationItem__Text">スコアボードAPIを利用する</span></a></div></div><div><a class="MainNavigationItem" title="プレイ中のゲームのスクリーンショットを撮影し、Twitterに投稿することもできる「スクリーンショットダイアログ」の表示を行います。" href="https://atsumaru.github.io/api-references/screenshot"><svg viewBox="0 0 24 24" class="MainNavigationItem__Icon"><path d="M9 2C8 2 8 3 8 3s0 1 1 1v7.367188l-3.9335938 6.884765c-1.0407086 1.821241-1.11276 3.000196-.7734374 3.763672.3393224.763476 1.0859374.96875 1.0859374.96875.0395749.010135.0802425.015383.1210938.015625h13c.04085-.000242.08152-.005495.121094-.015625 0 0 .746615-.205274 1.085937-.96875.339323-.763476.267272-1.942431-.773437-3.763672L15 11.367188V4s1 0 1-1-1-1-1-1h-1v9.5c.000167.08705.023056.172554.066406.248047l4 7c.959291 1.678759.88724 2.499804.726563 2.861328-.154565.347753-.380331.387021-.398438.390625H5.6054688c-.0181066-.003604-.2438806-.042872-.3984376-.390625-.1606773-.361524-.2327286-1.182569.7265626-2.861328l4-7c.043349-.075492.0662393-.160994.0664062-.248047V2H9zm1 12.5a1 1 0 0 0-1 1c-.1818651-.000015-.3493995.098711-.4375.257812l-2.5 4.5c-.18445.333279.0565842.742177.4375.742188h11c.380916-.000011.62195-.408909.4375-.742188l-2.5-4.5c-.0881-.1591-.255635-.257827-.4375-.257812h-.634766A1 1 0 0 0 13.5 15a1 1 0 0 0-.863281.5H11a1 1 0 0 0-1-1zm4 1.5a.5.5 0 0 1 .5.5.5.5 0 0 1-.5.5.5.5 0 0 1-.5-.5.5.5 0 0 1 .5-.5zm-3.5.5a.5.5 0 0 1 .5.5.5.5 0 0 1-.5.5.5.5 0 0 1-.5-.5.5.5 0 0 1 .5-.5zM13 18a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1z"></path></svg><span class="MainNavigationItem__Text">スクリーンショットをシェアする</span></a><div class="MainNavigationItem__Children" aria-hidden="true"></div></div><div><a class="MainNavigationItem" title="RPGアツマールのAPIが返すエラーについてのリファレンスです。" href="https://atsumaru.github.io/api-references/errors"><span class="MainNavigationItem__Text">エラーハンドリング</span></a><div class="MainNavigationItem__Children" aria-hidden="true"></div></div></nav><article class="MainSection markdown-body"><div><div class="Reference__Header"><h1>コメントを利用する</h1><a class="Reference__EditButton" href="https://github.com/atsumaru/api-references/blob/master/content/collections/apis/comment.md">編集</a></div><p class="Reference__Description">RPGアツマールのコメント機能を利用するにはCommentAPIを利用してください。</p><h2 id="概要">概要</h2>
<p>RPGアツマールでは、ユーザーのゲーム体験を共有するためにコメント機能を提供しています。設計はRPGツクールMVでの利用を想定していますがAPIは汎用的にも利用可能です。</p>
<h3 id="どんなことができるの？">どんなことができるの？</h3>
<p>機能を実行した際に、次のような操作を行います。</p>
<ul>
<li>コメントシステムのscene設定</li>
<li>sceneの切り替え</li>
<li>contextfactorの設定</li>
<li>contextの設定</li>
<li>minorcontextの設定</li>
</ul>
<h3 id="利用例">利用例</h3>
<p>RPGツクールMV製ゲームの場合、RPGアツマールが挿入する <code>rpgatsumaru.js</code> によって自動的にこの機能を利用しています。例えば以下のゲームで、この機能を利用してゲーム上にコメントを表示しています。</p>
<ul>
<li><a href="https://game.nicovideo.jp/atsumaru/games/gm7601" rel="noopener" target="_blank">【防衛ゲーム】タタの魔法使い【異世界サバイバル】</a><ul>
<li>ゲーム開始時（scene=<code>__title</code>）などで、右から左にコメントが流れます。</li>
</ul>
</li>
</ul>
<h2 id="詳細">詳細</h2>
<p>コメント機能は「コメントシステム」にゲーム状態を伝えると、コメントがゲーム上に流れてくるというものです。動画と異なり、時系列のようなプレイヤー全員が共有しているコンテンツの内部状態が存在しないため、ゲームでは逐次ゲーム状態をコメントシステムに伝える必要があります。この「とあるゲーム状態」のことを本システムではgame position(<strong>gpos</strong>)と呼んでいます。</p>
<p>RPGツクールMVにおいては、イベントコマンドごとにgposをコメントシステムに伝達しています。そのため、ヒロインのセリフなど特定の状態をプレイヤー間で共有できます。もし、あなたがアクションゲームをつくるなら「敵を倒した」「アイテムを得た」などのイベントをgposとしてコメントシステムに伝えることになるでしょう。</p>
<p>gposはsceneとcontextfactorとminorcontextという３つのパラメーターで表現します。プログラム的に書けば以下のようになるでしょう。</p>
<pre><code>gpos(scene, context(contextfactor[0,-1,-2],minorcontext))</code></pre><p>sceneはコメントデータ群を表しています。scene一つあたりで最新1,000件(変更可能性有り)で、直近5つのsceneをAPI側でキャッシュします。一般的なゲームではマップや戦闘画面、メニュー画面に相当します。</p>
<p>sceneのコメントを、contextの値で指定し取得することでコメントが描画されます。
contextは状態遷移マシンになっており、contextfactorをpushすることで状態が一つ進みます。状態はcontextfactor3つの複合キーで表されています。
一つの状態内でさらに細かく分割する場合、たとえば「あるイベント内の時間」などを示すにはminorcontextが便利です。minorcontextをpushするごとに状態が細かく進み、それに応じたコメントが描画されます。</p>
<p>RPGツクールMVにおいてはsceneはmapのidに対応します。
contextfactorは「セリフ」コマンドと「選択肢」コマンドで、minorcontextは「ウェイト」コマンドと、コマンド内のwaitに対応します。minorcontextがあることで、「セリフのあとにキャラクターが移動して演技する」ような演出に対して細かくコメントができます。</p>
<p><img src="https://atsumaru.github.io/api-references/images/comment.png" alt="概念図"/></p>
<h2 id="設置方法">設置方法</h2>
<p>コメント機能はアツマールAPIから利用可能です。</p>
<table><thead><tr><th align="left">方法</th><th align="left">場所</th></tr></thead><tbody><tr><td align="left">アツマール API</td><td align="left">-</td></tr></tbody></table>
<h2 id="APIを利用したサーバーセーブ機能の利用">APIを利用したサーバーセーブ機能の利用</h2>
<h3 id="シーン設定API">シーン設定API</h3>
<table><thead><tr><th align="left">メソッド</th><th align="left">window.RPGAtsumaru.comment.changeScene(sceneName)</th></tr></thead><tbody><tr><td align="left">説明</td><td align="left"><ul><li>コメントシステムのシーンを設定する。</li><li>シーンが切り替わると、そのシーンのコメント空間に切り替わる。</li><li>ツクールでは基本的にマップID=シーン名となる。</li><li>サーバーアクセスが発生する。（ただし直近5つのsceneはキャッシュされ、再アクセスには発生しない）</li><li>シーン名は64文字までのascii限定。</li></ul><br/>※なお、アンダースコア２つで始まるシーン名は特殊用途として予約されています。<br/>予約されている中で現在利用可能なシーン名は <code>__title</code> と <code>__gameover</code> の2つで、 <code>__title</code> は内部状態の初期値になっています。</td></tr><tr><td align="left">引数</td><td align="left">シーン名を表す文字列</td></tr><tr><td align="left">戻り値</td><td align="left">無し</td></tr><tr><td align="left">リリース日</td><td align="left">2016/12/27</td></tr><tr><td align="left">更新日</td><td align="left">2018/10/25</td></tr></tbody></table>
<h3 id="シーン切り替えAPI">シーン切り替えAPI</h3>
<table><thead><tr><th align="left">メソッド</th><th align="left">window.RPGAtsumaru.storage.setItems(items)</th></tr></thead><tbody><tr><td align="left">説明</td><td align="left"><ul><li>changeSceneと違い、context(contextfactorとminorcontext)による内部状態をリセットしつつシーンを切り替える</li><li>サーバーアクセスが発生する。（ただし直近5つのsceneはキャッシュされ、再アクセスには発生しない）</li><li>ツクール製ゲームではタイトルとゲームオーバーで全員同じコメントが流れる機能のために使用しています。</li></ul></td></tr><tr><td align="left">引数</td><td align="left">シーン名を表す文字列</td></tr><tr><td align="left">戻り値</td><td align="left">無し</td></tr><tr><td align="left">リリース日</td><td align="left">2016/12/27</td></tr><tr><td align="left">更新日</td><td align="left">2018/10/25</td></tr></tbody></table>
<h3 id="コンテキストファクターAPI">コンテキストファクターAPI</h3>
<table><thead><tr><th align="left">メソッド</th><th align="left">window.RPGAtsumaru.comment.pushContextFactor(factor)</th></tr></thead><tbody><tr><td align="left">説明</td><td align="left"><ul><li>コメントシステムにContextFactorとなる値(ツクールでいうセリフと選択肢)をpushして、contextを更新する。</li><li>contextが更新されたことでgposが更新され、文脈にあわせたコメントが流れる。</li><li>また、minorcontextを初期化する。</li></ul></td></tr><tr><td align="left">引数</td><td align="left">コメントシステムにpushするコンテキストを表す文字列</td></tr><tr><td align="left">戻り値</td><td align="left">無し</td></tr><tr><td align="left">リリース日</td><td align="left">2016/12/27</td></tr><tr><td align="left">更新日</td><td align="left">2018/10/25</td></tr></tbody></table>
<h3 id="マイナーコンテキストAPI">マイナーコンテキストAPI</h3>
<table><thead><tr><th align="left">メソッド</th><th align="left">window.RPGAtsumaru.comment.pushMinorContext()</th></tr></thead><tbody><tr><td align="left">説明</td><td align="left"><ul><li>コメントシステムのgposを更新する。</li><li>contextが更新されたことでgposKeyが更新され、文脈にあわせたコメントが流れる。</li><li>内部的にminorcontext値を持っており、それを+1することでgposを更新している。pushContextFactorを使うと、minorcontext値は初期値に戻される。</li><li>MinorContextは「ContextFactorのさらに細かい状態」を想定している。</li><li>ツクールではエンジンにwaitがかかるような命令で使用している。</li></ul></td></tr><tr><td align="left">引数</td><td align="left">無し</td></tr><tr><td align="left">戻り値</td><td align="left">無し</td></tr><tr><td align="left">リリース日</td><td align="left">2016/12/27</td></tr><tr><td align="left">更新日</td><td align="left">2018/10/25</td></tr></tbody></table>
<h3 id="コンテキストAPI">コンテキストAPI</h3>
<table><thead><tr><th align="left">メソッド</th><th align="left">window.RPGAtsumaru.comment.setContext(context)</th></tr></thead><tbody><tr><td align="left">説明</td><td align="left"><ul><li>pushContextFactorと違い、contextを引数に渡した値で直接書き換える。</li><li>特定のScene内でまったく同じゲーム状態を厳密に作りたい場合に使う。</li><li>このときの context の値は、ascii 64文字以下推奨。</li></ul></td></tr><tr><td align="left">引数</td><td align="left">コンテキスト値を表す文字列</td></tr><tr><td align="left">戻り値</td><td align="left">無し</td></tr><tr><td align="left">リリース日</td><td align="left">2016/12/27</td></tr><tr><td align="left">更新日</td><td align="left">2018/10/25</td></tr></tbody></table></div></article></main><footer class="Footer"><nav class="Footer__Nav"><a href="https://game.nicovideo.jp/atsumaru/">RPGアツマール に戻る</a></nav><span>©DWANGO Co., Ltd.</span></footer></div></div><script type="text/javascript">window.__CSS_CHUNKS__ = {"main":"https://atsumaru.github.io/api-references/styles.0f364fc3.css"}</script><script type="text/javascript">
    window.__routeInfo = {"path":"comment","templateID":1,"sharedPropsHashes":{"apiList":"17j4mt"},"localProps":null,"allProps":{"apiList":[{"title":"コメントを利用する","slug":"comment","description":"RPGアツマールのコメント機能を利用するにはCommentAPIを利用してください。","order":10,"children":[]},{"title":"コントローラーを利用する","slug":"controller","description":"スマートフォンでのゲームプレイ時に、バーチャルコントローラーからの入力を受け取るためのAPIです。","order":11,"children":[]},{"title":"サーバーにセーブを保存する","slug":"storage","description":"サーバーセーブ機能を利用するにはStorageAPIを利用してください。サーバーセーブ機能は現在APIのみで利用が可能で、プラグインを通じた機能利用はできません。","order":12,"children":[]},{"title":"マスターボリュームの設定","slug":"volume","description":"マスターボリュームの調整を行うにはVolumeAPIを利用してください。マスターボリューム設定は現在APIのみで利用が可能で、プラグインを通じた機能利用はできません。","order":13,"children":[]},{"title":"外部リンクを表示する","slug":"popup","description":"RPGアツマールで外部リンクを設置したい場合は、専用のダイアログを開いてダイアログ内で外部リンクを表示します。","order":20,"children":[]},{"title":"クエリ情報の取得","slug":"copy-query","description":"RPGアツマールでURLのquery情報を取得するにはこの機能を利用します。","order":21,"experimental":true,"children":[]},{"title":"作者情報を表示する","slug":"creator-modal","description":"RPGアツマールのゲームの作者情報が記載されたダイアログを表示することができます。","order":22,"experimental":true,"children":[]},{"title":"スコアボードを利用する","slug":"scoreboard","description":"RPGアツマール内で動作するゲームのスコア(点数)を記録・取得できる仕組みです。","order":23,"experimental":true,"children":[{"title":"スコアボード設定画面を利用する","slug":"scoreboard/setting","description":"スコアボードの設定画面の使用方法を解説します。","order":1,"experimental":true},{"title":"スコアボードプラグインを利用する","slug":"scoreboard/plugin","description":"公式プラグインを利用した、スコアボードの利用方法について解説します。","order":2,"experimental":true},{"title":"スコアボードAPIを利用する","slug":"scoreboard/api","description":"アツマールAPIを使ったスコアボードの利用方法について解説します。","order":3,"experimental":true}]},{"title":"スクリーンショットをシェアする","slug":"screenshot","description":"プレイ中のゲームのスクリーンショットを撮影し、Twitterに投稿することもできる「スクリーンショットダイアログ」の表示を行います。","order":24,"experimental":true,"children":[]},{"title":"エラーハンドリング","slug":"errors","description":"RPGアツマールのAPIが返すエラーについてのリファレンスです。","order":99,"children":[]}],"reference":{"title":"コメントを利用する","slug":"comment","description":"RPGアツマールのコメント機能を利用するにはCommentAPIを利用してください。","order":10,"contents":"<h2>概要</h2>\n<p>RPGアツマールでは、ユーザーのゲーム体験を共有するためにコメント機能を提供しています。設計はRPGツクールMVでの利用を想定していますがAPIは汎用的にも利用可能です。</p>\n<h3>どんなことができるの？</h3>\n<p>機能を実行した際に、次のような操作を行います。</p>\n<ul>\n<li>コメントシステムのscene設定</li>\n<li>sceneの切り替え</li>\n<li>contextfactorの設定</li>\n<li>contextの設定</li>\n<li>minorcontextの設定</li>\n</ul>\n<h3>利用例</h3>\n<p>RPGツクールMV製ゲームの場合、RPGアツマールが挿入する <code>rpgatsumaru.js</code> によって自動的にこの機能を利用しています。例えば以下のゲームで、この機能を利用してゲーム上にコメントを表示しています。</p>\n<ul>\n<li><a href=\"https://game.nicovideo.jp/atsumaru/games/gm7601\">【防衛ゲーム】タタの魔法使い【異世界サバイバル】</a><ul>\n<li>ゲーム開始時（scene=<code>__title</code>）などで、右から左にコメントが流れます。</li>\n</ul>\n</li>\n</ul>\n<h2>詳細</h2>\n<p>コメント機能は「コメントシステム」にゲーム状態を伝えると、コメントがゲーム上に流れてくるというものです。動画と異なり、時系列のようなプレイヤー全員が共有しているコンテンツの内部状態が存在しないため、ゲームでは逐次ゲーム状態をコメントシステムに伝える必要があります。この「とあるゲーム状態」のことを本システムではgame position(<strong>gpos</strong>)と呼んでいます。</p>\n<p>RPGツクールMVにおいては、イベントコマンドごとにgposをコメントシステムに伝達しています。そのため、ヒロインのセリフなど特定の状態をプレイヤー間で共有できます。もし、あなたがアクションゲームをつくるなら「敵を倒した」「アイテムを得た」などのイベントをgposとしてコメントシステムに伝えることになるでしょう。</p>\n<p>gposはsceneとcontextfactorとminorcontextという３つのパラメーターで表現します。プログラム的に書けば以下のようになるでしょう。</p>\n<pre><code>gpos(scene, context(contextfactor[0,-1,-2],minorcontext))</code></pre><p>sceneはコメントデータ群を表しています。scene一つあたりで最新1,000件(変更可能性有り)で、直近5つのsceneをAPI側でキャッシュします。一般的なゲームではマップや戦闘画面、メニュー画面に相当します。</p>\n<p>sceneのコメントを、contextの値で指定し取得することでコメントが描画されます。\ncontextは状態遷移マシンになっており、contextfactorをpushすることで状態が一つ進みます。状態はcontextfactor3つの複合キーで表されています。\n一つの状態内でさらに細かく分割する場合、たとえば「あるイベント内の時間」などを示すにはminorcontextが便利です。minorcontextをpushするごとに状態が細かく進み、それに応じたコメントが描画されます。</p>\n<p>RPGツクールMVにおいてはsceneはmapのidに対応します。\ncontextfactorは「セリフ」コマンドと「選択肢」コマンドで、minorcontextは「ウェイト」コマンドと、コマンド内のwaitに対応します。minorcontextがあることで、「セリフのあとにキャラクターが移動して演技する」ような演出に対して細かくコメントができます。</p>\n<p><img src=\"https://atsumaru.github.io/api-references/images/comment.png\" alt=\"概念図\"></p>\n<h2>設置方法</h2>\n<p>コメント機能はアツマールAPIから利用可能です。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">方法</th>\n<th align=\"left\">場所</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">アツマール API</td>\n<td align=\"left\">-</td>\n</tr>\n</tbody></table>\n<h2>APIを利用したサーバーセーブ機能の利用</h2>\n<h3>シーン設定API</h3>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\">window.RPGAtsumaru.comment.changeScene(sceneName)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\"><ul><li>コメントシステムのシーンを設定する。</li><li>シーンが切り替わると、そのシーンのコメント空間に切り替わる。</li><li>ツクールでは基本的にマップID=シーン名となる。</li><li>サーバーアクセスが発生する。（ただし直近5つのsceneはキャッシュされ、再アクセスには発生しない）</li><li>シーン名は64文字までのascii限定。</li></ul><br>※なお、アンダースコア２つで始まるシーン名は特殊用途として予約されています。<br>予約されている中で現在利用可能なシーン名は <code>__title</code> と <code>__gameover</code> の2つで、 <code>__title</code> は内部状態の初期値になっています。</td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">シーン名を表す文字列</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\">無し</td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2016/12/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/10/25</td>\n</tr>\n</tbody></table>\n<h3>シーン切り替えAPI</h3>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\">window.RPGAtsumaru.storage.setItems(items)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\"><ul><li>changeSceneと違い、context(contextfactorとminorcontext)による内部状態をリセットしつつシーンを切り替える</li><li>サーバーアクセスが発生する。（ただし直近5つのsceneはキャッシュされ、再アクセスには発生しない）</li><li>ツクール製ゲームではタイトルとゲームオーバーで全員同じコメントが流れる機能のために使用しています。</li></ul></td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">シーン名を表す文字列</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\">無し</td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2016/12/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/10/25</td>\n</tr>\n</tbody></table>\n<h3>コンテキストファクターAPI</h3>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\">window.RPGAtsumaru.comment.pushContextFactor(factor)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\"><ul><li>コメントシステムにContextFactorとなる値(ツクールでいうセリフと選択肢)をpushして、contextを更新する。</li><li>contextが更新されたことでgposが更新され、文脈にあわせたコメントが流れる。</li><li>また、minorcontextを初期化する。</li></ul></td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">コメントシステムにpushするコンテキストを表す文字列</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\">無し</td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2016/12/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/10/25</td>\n</tr>\n</tbody></table>\n<h3>マイナーコンテキストAPI</h3>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\">window.RPGAtsumaru.comment.pushMinorContext()</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\"><ul><li>コメントシステムのgposを更新する。</li><li>contextが更新されたことでgposKeyが更新され、文脈にあわせたコメントが流れる。</li><li>内部的にminorcontext値を持っており、それを+1することでgposを更新している。pushContextFactorを使うと、minorcontext値は初期値に戻される。</li><li>MinorContextは「ContextFactorのさらに細かい状態」を想定している。</li><li>ツクールではエンジンにwaitがかかるような命令で使用している。</li></ul></td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">無し</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\">無し</td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2016/12/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/10/25</td>\n</tr>\n</tbody></table>\n<h3>コンテキストAPI</h3>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\">window.RPGAtsumaru.comment.setContext(context)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\"><ul><li>pushContextFactorと違い、contextを引数に渡した値で直接書き換える。</li><li>特定のScene内でまったく同じゲーム状態を厳密に作りたい場合に使う。</li><li>このときの context の値は、ascii 64文字以下推奨。</li></ul></td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">コンテキスト値を表す文字列</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\">無し</td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2016/12/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/10/25</td>\n</tr>\n</tbody></table>\n"},"title":"コメントを利用する","path":"/comment"},"siteData":{}};</script><script defer="" type="text/javascript" src="https://atsumaru.github.io/api-references/bootstrap.1f779964.js"></script><script defer="" type="text/javascript" src="https://atsumaru.github.io/api-references/templates/src/containers/Reference.139ff39d.js"></script><script defer="" type="text/javascript" src="https://atsumaru.github.io/api-references/main.103f01e7.js"></script></body></html>