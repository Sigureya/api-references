{"path":"comment","templateID":1,"sharedPropsHashes":{"apiList":"1dgox1"},"localProps":{"reference":{"title":"コメントを利用する","slug":"comment","description":"RPGアツマールのコメント機能を利用するにはCommentAPIを利用してください。","order":10,"contents":"<h2>概要</h2>\n<p>RPGアツマールでは、ユーザーのゲーム体験を共有するためにコメント機能を提供しています。設計はRPGツクールMVでの利用を想定していますがAPIは汎用的にも利用可能です。</p>\n<h3>どんなことができるの？</h3>\n<p>機能を実行した際に、次のような操作を行います。</p>\n<ul>\n<li>コメントシステムのscene設定</li>\n<li>sceneの切り替え</li>\n<li>contextfactorの設定</li>\n<li>contextの設定</li>\n<li>minorcontextの設定</li>\n</ul>\n<h3>利用例</h3>\n<p>RPGツクールMV製ゲームの場合、RPGアツマールが挿入する <code>rpgatsumaru.js</code> によって自動的にこの機能を利用しています。例えば以下のゲームで、この機能を利用してゲーム上にコメントを表示しています。</p>\n<ul>\n<li><a href=\"https://game.nicovideo.jp/atsumaru/games/gm7601\">【防衛ゲーム】タタの魔法使い【異世界サバイバル】</a><ul>\n<li>ゲーム開始時（scene=<code>__title</code>）などで、右から左にコメントが流れます。</li>\n</ul>\n</li>\n</ul>\n<h2>詳細</h2>\n<p>コメント機能は「コメントシステム」にゲーム状態を伝えると、コメントがゲーム上に流れてくるというものです。動画と異なり、時系列のようなプレイヤー全員が共有しているコンテンツの内部状態が存在しないため、ゲームでは逐次ゲーム状態をコメントシステムに伝える必要があります。この「とあるゲーム状態」のことを本システムではgame position(<strong>gpos</strong>)と呼んでいます。</p>\n<p>RPGツクールMVにおいては、イベントコマンドごとにgposをコメントシステムに伝達しています。そのため、ヒロインのセリフなど特定の状態をプレイヤー間で共有できます。もし、あなたがアクションゲームをつくるなら「敵を倒した」「アイテムを得た」などのイベントをgposとしてコメントシステムに伝えることになるでしょう。</p>\n<p>gposはsceneとcontextfactorとminorcontextという３つのパラメーターで表現します。プログラム的に書けば以下のようになるでしょう。</p>\n<pre><code>gpos(scene, context(contextfactor[0,-1,-2],minorcontext))</code></pre><p>sceneはコメントデータ群を表しています。scene一つあたりで最新1,000件(変更可能性有り)で、直近5つのsceneをAPI側でキャッシュします。一般的なゲームではマップや戦闘画面、メニュー画面に相当します。</p>\n<p>sceneのコメントを、contextの値で指定し取得することでコメントが描画されます。\ncontextは状態遷移マシンになっており、contextfactorをpushすることで状態が一つ進みます。状態はcontextfactor3つの複合キーで表されています。\n一つの状態内でさらに細かく分割する場合、たとえば「あるイベント内の時間」などを示すにはminorcontextが便利です。minorcontextをpushするごとに状態が細かく進み、それに応じたコメントが描画されます。</p>\n<p>RPGツクールMVにおいてはsceneはmapのidに対応します。\ncontextfactorは「セリフ」コマンドと「選択肢」コマンドで、minorcontextは「ウェイト」コマンドと、コマンド内のwaitに対応します。minorcontextがあることで、「セリフのあとにキャラクターが移動して演技する」ような演出に対して細かくコメントができます。</p>\n<p><img src=\"https://atsumaru.github.io/api-references/images/comment.png\" alt=\"概念図\"></p>\n<h2>設置方法</h2>\n<p>コメント機能はアツマールAPIから利用可能です。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">方法</th>\n<th align=\"left\">場所</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">アツマール API</td>\n<td align=\"left\">-</td>\n</tr>\n</tbody></table>\n<h2>APIを利用したコメント機能の利用</h2>\n<h3>シーン設定API</h3>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\">window.RPGAtsumaru.comment.changeScene(sceneName)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\"><ul><li>コメントシステムのシーンを設定する。</li><li>シーンが切り替わると、そのシーンのコメント空間に切り替わる。</li><li>ツクールでは基本的にマップID=シーン名となる。</li><li>サーバーアクセスが発生する。（ただし直近5つのsceneはキャッシュされ、再アクセスには発生しない）</li><li>シーン名は64文字までのascii限定。</li></ul><br>※なお、アンダースコア２つで始まるシーン名は特殊用途として予約されています。<br>予約されている中で現在利用可能なシーン名は <code>__title</code> と <code>__gameover</code> の2つで、 <code>__title</code> は内部状態の初期値になっています。</td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">シーン名を表す文字列</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\">無し</td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2016/12/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/10/25</td>\n</tr>\n</tbody></table>\n<h3>シーン切り替えAPI</h3>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\">window.RPGAtsumaru.comment.resetAndChangeScene(sceneName)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\"><ul><li>changeSceneと違い、context(contextfactorとminorcontext)による内部状態をリセットしつつシーンを切り替える</li><li>サーバーアクセスが発生する。（ただし直近5つのsceneはキャッシュされ、再アクセスには発生しない）</li><li>ツクール製ゲームではタイトルとゲームオーバーで全員同じコメントが流れる機能のために使用しています。</li></ul></td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">シーン名を表す文字列</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\">無し</td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2016/12/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/10/25</td>\n</tr>\n</tbody></table>\n<h3>コンテキストファクターAPI</h3>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\">window.RPGAtsumaru.comment.pushContextFactor(factor)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\"><ul><li>コメントシステムにContextFactorとなる値(ツクールでいうセリフと選択肢)をpushして、contextを更新する。</li><li>contextが更新されたことでgposが更新され、文脈にあわせたコメントが流れる。</li><li>また、minorcontextを初期化する。</li></ul></td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">コメントシステムにpushするコンテキストを表す文字列</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\">無し</td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2016/12/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/10/25</td>\n</tr>\n</tbody></table>\n<h3>マイナーコンテキストAPI</h3>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\">window.RPGAtsumaru.comment.pushMinorContext()</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\"><ul><li>コメントシステムのgposを更新する。</li><li>contextが更新されたことでgposKeyが更新され、文脈にあわせたコメントが流れる。</li><li>内部的にminorcontext値を持っており、それを+1することでgposを更新している。pushContextFactorを使うと、minorcontext値は初期値に戻される。</li><li>MinorContextは「ContextFactorのさらに細かい状態」を想定している。</li><li>ツクールではエンジンにwaitがかかるような命令で使用している。</li></ul></td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">無し</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\">無し</td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2016/12/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/10/25</td>\n</tr>\n</tbody></table>\n<h3>コンテキストAPI</h3>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\">window.RPGAtsumaru.comment.setContext(context)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\"><ul><li>pushContextFactorと違い、contextを引数に渡した値で直接書き換える。</li><li>特定のScene内でまったく同じゲーム状態を厳密に作りたい場合に使う。</li><li>このときの context の値は、ascii 64文字以下推奨。</li></ul></td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">コンテキスト値を表す文字列</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\">無し</td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2016/12/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/10/25</td>\n</tr>\n</tbody></table>\n"},"title":"コメントを利用する","path":"/comment"}}
